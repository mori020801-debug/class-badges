<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>名札表示</title>
  <style>
    :root{
      --bg:#0b1220; --fg:#fff;
    }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;}
    .wrap{height:100%; display:flex; align-items:center; justify-content:center; text-align:center; padding:1rem; box-sizing:border-box;}
    .card{width:100%; max-width:1600px; padding:0 1rem; box-sizing:border-box;}
    /* 名前表示（より大きく） */
    .name{
      font-weight:900;
      line-height:0.94;
      word-break:break-word;
      letter-spacing:0.01em;
      white-space:normal;
      margin:0 auto;
      max-width:96%;
      /* ベースは画面高さを優先してかなり大きめに */
      font-size: clamp(36px, 12vh + 6vw, 360px);
    }
    /* 補助テキスト（表示は小さく目立たない） */
    .sub{font-size:calc(1.8vh + 1vw); opacity:0.9; margin-top:0.6rem;}
    .controls{position:fixed; left:10px; top:10px; display:flex; gap:8px; z-index:30;}
    .controls button{padding:8px 10px; border-radius:8px; border:0; background:rgba(255,255,255,0.12); color:inherit; backdrop-filter:blur(6px);}
    .hint{position:fixed; bottom:8px; width:100%; text-align:center; font-size:13px; opacity:0.95;}
    .overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); color:#fff; z-index:40; padding:1rem; text-align:center;}
    .hidden{display:none;}
    input.name-input{font-size:18px; padding:10px; width:80%; max-width:400px; border-radius:8px; border:0; outline:none;}
    .btn{margin-left:8px; padding:10px 14px; border-radius:8px; border:0;}

    /* ランドスケープ用さらに大きめ */
    @media (orientation: landscape) {
      .name{
        font-size: clamp(48px, 22vh, 420px); /* 横向きで高さを優先してより大きく */
      }
      .sub{font-size: calc(2.6vh + 0.8vw);}
    }

    /* 小さめの画面は操作ボタンを隠して表示領域を確保 */
    @media (max-width:420px){
      .controls{display:none;}
      .hint{font-size:12px;}
      .sub{font-size:13px;}
    }
  </style>
</head>
<body>
  <div class="controls" aria-hidden="true">
    <button id="bgDark">黒</button>
    <button id="bgLight">白</button>
    <button id="bgYellow">黄</button>
  </div>

  <div class="wrap" role="main">
    <div class="card">
      <h1 id="nameEl" class="name" aria-live="polite">（名前を設定してください）</h1>
      <!-- 「画面を横向きにして下さい」の文言を削除 -->
      <div id="subEl" class="sub" aria-hidden="true"></div>
    </div>
  </div>

  <!-- 初回入力用モーダルは残す（最初だけ名前を受け取るため） -->
  <div id="inputOverlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div>
      <div style="font-size:20px; font-weight:700; margin-bottom:10px;">表示する名前を入力してください</div>
      <div><input id="nameInput" class="name-input" placeholder="例：山田 太郎" aria-label="表示名"></div>
      <div style="margin-top:10px;"><button id="saveBtn" class="btn">保存して表示</button></div>
      <div style="margin-top:12px; font-size:13px; opacity:0.9">※ホーム画面に追加すると次回ワンタップで開けます</div>
    </div>
  </div>

  <div class="hint" aria-hidden="true">ホーム画面に追加すると次回ワンタップで開けます（iPhone：Safariの共有→「ホーム画面に追加」、Android：Chromeメニュー→「ホーム画面に追加」）。</div>

<script>
  const nameEl = document.getElementById('nameEl');
  const subEl = document.getElementById('subEl');
  const inputOverlay = document.getElementById('inputOverlay');
  const nameInput = document.getElementById('nameInput');
  const saveBtn = document.getElementById('saveBtn');

  function getParam(k){ return new URLSearchParams(location.search).get(k); }
  const storageKey = 'class_badge_name_v3';

  function setName(n){
    if(!n) n = '（名前が未設定）';
    nameEl.textContent = n;
    document.title = n + ' — 名札';
    adjustFont(); // 表示を即調整
  }

  // 背景切替
  document.getElementById('bgDark').onclick = ()=>{ document.body.style.background='#0b1220'; document.body.style.color='#fff'; }
  document.getElementById('bgLight').onclick = ()=>{ document.body.style.background='#ffffff'; document.body.style.color='#000'; }
  document.getElementById('bgYellow').onclick = ()=>{ document.body.style.background='#ffec3d'; document.body.style.color='#000'; }

  // 名前取得ロジック：URL param > localStorage > input
  (function initName(){
    const paramName = getParam('name');
    if(paramName){
      const decoded = decodeURIComponent(paramName);
      setName(decoded);
      try{ localStorage.setItem(storageKey, decoded); }catch(e){}
    } else {
      try{
        const stored = localStorage.getItem(storageKey);
        if(stored){
          setName(stored);
        } else {
          inputOverlay.classList.remove('hidden');
          nameInput.focus();
          saveBtn.onclick = ()=>{
            const v = nameInput.value.trim();
            if(v){
              setName(v);
              inputOverlay.classList.add('hidden');
              try{ localStorage.setItem(storageKey, v); }catch(e){}
            } else { alert('名前を入力してください'); }
          };
        }
      } catch(e){
        const p = prompt('表示する名前を入力してください（例：山田 太郎）');
        setName(p);
      }
    }
  })();

  // フォント自動調整：名前が横幅を超える場合は縮小する／ランドスケープでは高さ優先で拡大
  function adjustFont(){
    const el = nameEl;
    // ランドスケープなら高さ比率を高めにして大きくする
    if(window.innerWidth > window.innerHeight){
      el.style.fontSize = Math.round(window.innerHeight * 0.28) + 'px'; // 高さの28%
    } else {
      el.style.fontSize = Math.round(window.innerHeight * 0.14) + 'px'; // 縦向きは控えめ
    }

    // 横幅を越えるなら縮小ループ
    const maxWidth = window.innerWidth * 0.96;
    let fs = parseFloat(getComputedStyle(el).fontSize);
    const minFs = 16;
    let limit = 0;
    while(el.scrollWidth > maxWidth && fs > minFs && limit < 40){
      fs = fs * 0.95;
      el.style.fontSize = fs + 'px';
      limit++;
    }
  }

  // 初回・回転・リサイズで再調整
  setTimeout(adjustFont, 120);
  window.addEventListener('resize', () => { setTimeout(adjustFont, 80); });
  window.addEventListener('orientationchange', () => { setTimeout(adjustFont, 150); });

</script>
</body>
</html>
