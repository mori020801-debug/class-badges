<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>名札表示</title>
  <style>
    :root{
      --bg:#0b1220; --fg:#fff;
    }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;}
    .wrap{height:100%; display:flex; align-items:center; justify-content:center; text-align:center; padding:1rem; box-sizing:border-box;}
    .card{width:100%; max-width:1600px; padding:0 1rem; box-sizing:border-box;}
    /* 名前表示 */
    .name{
      font-weight:900;
      line-height:0.94;
      word-break:break-word;
      letter-spacing:0.01em;
      white-space:normal;
      margin:0 auto;
      max-width:96%;
      font-size: clamp(36px, 12vh + 6vw, 360px);
    }
    .sub{font-size:calc(1.8vh + 1vw); opacity:0.0; margin-top:0.6rem;}

    /* カラーボタン群 */
    .controls{
      position:fixed;
      z-index:40;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      padding:8px;
      box-sizing:border-box;
      left:50%;
      transform:translateX(-50%);
      top:8px; /* portrait でも上部中央に表示 */
      flex-wrap:wrap;
    }
    /* landscape では左上に寄せる */
    @media (orientation: landscape){
      .controls{ left:10px; transform:none; top:10px; }
    }

    .color-btn{
      display:flex;
      align-items:center;
      gap:8px;
      border:0;
      padding:10px 12px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      min-width:56px;
      min-height:44px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition:transform .08s ease, box-shadow .08s ease;
      user-select:none;
    }
    .color-btn:active{ transform:translateY(1px); }
    .swatch{ width:20px; height:20px; border-radius:6px; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.12); }

    /* 小画面でもボタンがはみ出さないように小さめ対応 */
    @media (max-width:420px){
      .color-btn{ padding:8px 10px; min-width:48px; min-height:40px; font-size:14px; border-radius:8px; }
      .swatch{ width:16px; height:16px; border-radius:5px; }
    }

    /* ランドスケープ用さらに大きめ表示（名前） */
    @media (orientation: landscape) {
      .name{
        font-size: clamp(48px, 22vh, 420px);
      }
      .sub{font-size: calc(2.6vh + 0.8vw);}
    }

    /* 入力モーダル */
    .overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); color:#fff; z-index:50; padding:1rem; text-align:center;}
    .hidden{display:none;}
    input.name-input{font-size:18px; padding:10px; width:80%; max-width:400px; border-radius:8px; border:0; outline:none;}
    .btn{margin-left:8px; padding:10px 14px; border-radius:8px; border:0; font-weight:700;}
  </style>
</head>
<body>
  <!-- カラーボタン（5色） -->
  <div class="controls" role="toolbar" aria-label="背景色選択">
    <!-- data-bg = 背景色, data-fg = 文字色 -->
    <button class="color-btn" id="btnDark" data-bg="#0b1220" data-fg="#ffffff" aria-pressed="false" aria-label="黒背景">
      <span class="swatch" style="background:#0b1220;"></span>
      <span class="label">黒</span>
    </button>

    <button class="color-btn" id="btnWhite" data-bg="#ffffff" data-fg="#000000" aria-pressed="false" aria-label="白背景">
      <span class="swatch" style="background:#ffffff; border:1px solid #ddd;"></span>
      <span class="label">白</span>
    </button>

    <button class="color-btn" id="btnYellow" data-bg="#ffec3d" data-fg="#000000" aria-pressed="false" aria-label="黄色背景">
      <span class="swatch" style="background:#ffec3d;"></span>
      <span class="label">黄</span>
    </button>

    <button class="color-btn" id="btnCyan" data-bg="#00bcd4" data-fg="#000000" aria-pressed="false" aria-label="シアン背景">
      <span class="swatch" style="background:#00bcd4;"></span>
      <span class="label">水</span>
    </button>

    <button class="color-btn" id="btnOrange" data-bg="#ff7043" data-fg="#000000" aria-pressed="false" aria-label="オレンジ背景">
      <span class="swatch" style="background:#ff7043;"></span>
      <span class="label">橙</span>
    </button>
  </div>

  <div class="wrap" role="main">
    <div class="card">
      <h1 id="nameEl" class="name" aria-live="polite">（名前を設定してください）</h1>
      <div id="subEl" class="sub" aria-hidden="true"></div>
    </div>
  </div>

  <!-- 初回入力モーダル -->
  <div id="inputOverlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div>
      <div style="font-size:20px; font-weight:700; margin-bottom:10px;">表示する名前を入力してください</div>
      <div><input id="nameInput" class="name-input" placeholder="例：山田 太郎" aria-label="表示名"></div>
      <div style="margin-top:10px;"><button id="saveBtn" class="btn">保存して表示</button></div>
    </div>
  </div>

<script>
  const nameEl = document.getElementById('nameEl');
  const inputOverlay = document.getElementById('inputOverlay');
  const nameInput = document.getElementById('nameInput');
  const saveBtn = document.getElementById('saveBtn');
  const controls = document.querySelectorAll('.color-btn');
  const storageNameKey = 'class_badge_name_v3';
  const storageBgKey = 'class_badge_color_bg';
  const storageFgKey = 'class_badge_color_fg';

  function getParam(k){ return new URLSearchParams(location.search).get(k); }

  // 名前表示
  function setName(n){
    if(!n) n = '（名前が未設定）';
    nameEl.textContent = n;
    document.title = n + ' — 名札';
    adjustFont();
  }

  // 色変更
  function setColor(bg, fg, persist = true){
    document.body.style.background = bg;
    document.body.style.color = fg;
    // Ensure name element inherits correct color style if needed
    nameEl.style.color = fg;
    if(persist){
      try{
        localStorage.setItem(storageBgKey, bg);
        localStorage.setItem(storageFgKey, fg);
      }catch(e){}
    }
    // update aria-pressed on buttons
    controls.forEach(btn=>{
      const is = (btn.getAttribute('data-bg') === bg && btn.getAttribute('data-fg') === fg);
      btn.setAttribute('aria-pressed', is ? 'true' : 'false');
    });
  }

  // init color buttons
  controls.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const bg = btn.getAttribute('data-bg');
      const fg = btn.getAttribute('data-fg');
      setColor(bg, fg, true);
    });
  });

  // 名前取得ロジック：URL param > localStorage > input
  (function initNameAndColor(){
    // color first (apply saved or default)
    try{
      const savedBg = localStorage.getItem(storageBgKey);
      const savedFg = localStorage.getItem(storageFgKey);
      if(savedBg && savedFg){
        setColor(savedBg, savedFg, false);
      } else {
        setColor('#0b1220', '#ffffff', false); // default
      }
    }catch(e){
      setColor('#0b1220', '#ffffff', false);
    }

    // name
    const paramName = getParam('name');
    if(paramName){
      const decoded = decodeURIComponent(paramName);
      setName(decoded);
      try{ localStorage.setItem(storageNameKey, decoded); }catch(e){}
    } else {
      try{
        const stored = localStorage.getItem(storageNameKey);
        if(stored){
          setName(stored);
        } else {
          inputOverlay.classList.remove('hidden');
          nameInput.focus();
          saveBtn.onclick = ()=>{
            const v = nameInput.value.trim();
            if(v){
              setName(v);
              inputOverlay.classList.add('hidden');
              try{ localStorage.setItem(storageNameKey, v); }catch(e){}
            } else { alert('名前を入力してください'); }
          };
        }
      } catch(e){
        const p = prompt('表示する名前を入力してください（例：山田 太郎）');
        setName(p);
      }
    }
  })();

  // フォント自動調整
  function adjustFont(){
    const el = nameEl;
    if(window.innerWidth > window.innerHeight){
      el.style.fontSize = Math.round(window.innerHeight * 0.28) + 'px';
    } else {
      el.style.fontSize = Math.round(window.innerHeight * 0.14) + 'px';
    }
    const maxWidth = window.innerWidth * 0.96;
    let fs = parseFloat(getComputedStyle(el).fontSize);
    const minFs = 16;
    let limit = 0;
    while(el.scrollWidth > maxWidth && fs > minFs && limit < 40){
      fs = fs * 0.95;
      el.style.fontSize = fs + 'px';
      limit++;
    }
  }

  setTimeout(adjustFont, 120);
  window.addEventListener('resize', () => { setTimeout(adjustFont, 80); });
  window.addEventListener('orientationchange', () => { setTimeout(adjustFont, 150); });

</script>
</body>
</html>
